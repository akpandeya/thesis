% warn about LaTeX 'sins'
\RequirePackage[l2tabu, orthodox]{nag}

\documentclass[
     a4paper
    ,fontsize=12pt
    ,titlepage=false
    ,fleqn
    ,oneside
]{scrartcl}

%%% latex-report settings
\providecommand{\lrDirectory}{latex-report}
\providecommand{\lrDate}{\today}

\usepackage{etoolbox}
\providetoggle{lrHideToc}
\providetoggle{lrHideTitle}
\providetoggle{lrSmallHeadings}

% Run this code only after the user had the chance to change the toggles
\AtEndPreamble{
    %%% Small headings?
    \iftoggle{lrSmallHeadings}{
        \KOMAoptions{headings=small}
    }{}
}

%%% Fonts, encoding
\usepackage[utf8]{inputenc}
\usepackage{lmodern}

%%% Math
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{upgreek}
\usepackage{xspace}
\usepackage{bm}
\usepackage{dsfont}
\usepackage{siunitx}

% Bold vectors
\renewcommand{\vec}[1]{\mathbf{#1}}

% redefine \\ inside align to add \notag to all equations except the last
\makeatletter
\def\Let@{\def\\{\notag\math@cr}}
\makeatother

%%% Graphics
\usepackage{graphicx}
\usepackage{subfig}
\usepackage[
     font=small
    ,labelfont=bf
]{caption}
\captionsetup[figure]{name=Fig.}
\graphicspath{{fig/}}

%%% Layout and typesetting
\usepackage{booktabs}
\usepackage{microtype}

%%% Header
\usepackage[automark,headsepline]{scrlayer-scrpage}
\clearpairofpagestyles
\cfoot[\pagemark]{\pagemark}
\ohead[\lrTitle]{\textrm{\lrTitle}}
\pagestyle{scrheadings}

%%% Remove TOC headings
\makeatletter
\renewcommand\tableofcontents{%
    \@starttoc{toc}%
}
\makeatother

%%% Hyperref
\usepackage{color}
\definecolor{blue}{rgb}{0.,0.4,1}

\usepackage[
     pdfusetitle
    ,colorlinks=true
    ,citecolor=blue
    ,linkcolor=blue
    ,pdfborder={0 0 0}
    ,unicode=true
]{hyperref}

%%% Custom commands
\input{\lrDirectory/include/commands}

%%% Run this code after \begin{document}
\AtBeginDocument{
    \title{\lrTitle}
    \author{\lrAuthor}
    \date{\lrDate}

    %%% Title section
    \nottoggle{lrHideTitle}{
        \noindent{\LARGE \textsf{\textbf{\lrTitle}}}\\
        \thispagestyle{empty}
    }{}

    %%% TOC
    \nottoggle{lrHideToc}{
        % Disable microtype protrusion for the TOC
        \microtypesetup{protrusion=false}
        \tableofcontents
        \microtypesetup{protrusion=true}
        \vspace{8mm}
    }{}
}
